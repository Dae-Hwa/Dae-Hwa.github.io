---
title: TIL-20211010~23
createdDate: "2021-10-12 01:57:22"
updatedDate: "2021-10-12 01:57:22"
author: 정대화
tags:
  - til
draft: false
---

## 10.10

Im-D 재정비 기간을 가지기로 했다. OS 스터디를 계속 하고 있지만, 특히 최근들어 꾸준히 진행되지 않았다. 지금 생각해보면 꼭 하고 싶다면 날짜나 시간을 바꿔서라도 할 수 있었을텐데 전체적인 에너지가 많이 떨어진 느낌이다. 뭐가 됐든 환기가 필요한 시점인것 같다. 다른 친구들도 관련 얘기를 계속 하긴했지만, 나는 OS를 믿고 외면했던 것 같다. 재정비 기간을 갖고 새로운 원동력을 잘 찾아봐야한다. 그래도 다행인점은 그룹 자체에 애정이 남아있는 것 같다는 점이다. 솔직히 어떻게 이어질지 잘 모르겠다. 그래도 고비를 잘 넘기면 새롭게 나갈 수 있을거라 믿어봐야겠다.

## 10.11

### ORM

객체와 관계 사이가 안 맞는 것을 impedance mismatch라고 한다. 전기쪽 용어에서 따왔다고 하는데, 자세하게 가면 수식의 향연이라 수학 까막눈인 나는 읽을 수가 없다. 쉽게 얘기하면 스피커와 앰프를 물릴때 저항(임피던스)을 고려해서 물려야 하는 것과 같은 현상이라 한다.

### was-pit stop1

노을은 주말동안 HTTP 학습을 해왔다고 한다. 재밌는 내용이 꽤 있었는데, post도 캐싱이 가능하다고 한다. 이외에도 몇 가지 요소들이 있었는데, 확실히 잘 정제된 강의를 보는게 좋은 것 같긴하다.

나는 객체지향의 사실과 오해를 다시 읽기 시작했다. 면접을 보며 객체지향을 좋아한다고 말했고 얼핏 아는 것 처럼 보이지만, 핵심을 꿰뚫지는 못하고 있다는 느낌을 많이 받았다. 특히 간단하게 설명하는 것이 힘들었다.

다시 책을 보니 예전에 했던 생각들이 많이 떠올라 메모를 해뒀다. 블로그를 왜 써야 하는지 다시 한 번 느낀다. 남을 위한 블로그가 아니라 나를 위한 블로그가 우선이라 생각하고 해보자.

오늘 얘기를 해보니 각자 공부한 내용을 서로에게 발표해보는 것도 좋을 것 같다는 생각이 들었다. 이번주는 각자 발표준비?를 하는 것을 목표로 잡았다.

### 트랜잭션

코드 리뷰를 하다 트랜잭션을 처리하는 다른 방법이 있지 않을까 해서 좀 더 고민해봤다. 가장 쉬운 방법은 트랜잭션으로 묶을 클래스를 만들고 콜백으로 테스트를 넣어준다. 지금 해놓은 것과 유사한 방식이다.

또 다른 방법은 트랜잭션을 직접 호출하는 것이다. entitymanager에서 트랜잭션을 직접 불러오는 것은 제대로 동작하지 않았다. PersistanceContext로 주입해서 그런 것 같은데 책을 우선 읽어보고 잘 안나오면 테스트를 해봐야 겠다. 검색으로는 못 찾겠다. 아무튼 스프링의 트랜잭션 매니저를 호출해주면 된다. 시작하면서 열어주면 될 것 같지만, BeforeEach의 동작은 순서가 보장되지 않아 문제가 될 수 있다. 콜백을 위한 템플릿 메소드를 만들면 되긴 한데, 어쨌든 부자연스러운 코드가 계속 생긴다.

원하는 것은 개발자가 추가적인 코드 조작 없이 테스트를 진행할 수 있도록 하는 것인데, 어떻게 하는게 좋을지 고민이 많이 필요해보인다. 얘기를 해봐야겠다.

### 테스트병렬화

테스트에 시간이 점점 오래걸려 걱정이라는 얘기가 있었다. 지금 5초정도 되는데 나중에는 1분정도까지 늘어날 것 같다. 그래서 테스트를 병렬로 실행시킬 수 있는 방법을 찾아봤다. 구동 자체는 어렵지 않았는데, 데이터베이스 동시성 처리가 제대로 되지 않아 문제가 생긴다. 좀 더 고민해봐야 할 문제다.

이외의 방법으로는 컨텍스트를 재활용할 수 있도록 만드는 방법이 있다. 이 점을 잘 활용해야 할 것 같다. 그리고 쿼리가 많이 느려지게되면 최적화도 고려해봐야 할 것 같다. <https://devhood.tistory.com/249> <https://okayjava.tistory.com/36>

## 10.12

### OSIV

영속성 컨텍스트를 공부하고 나니 의문이 하나 생겼다. 별도의 트랜잭션 없이 스프링의 서비스에서 레포지토리 메소드를 호출하고 나면 트랜잭션이 종료된다. 그러면 영속성 컨텍스트에서 엔티티가 분리돼야 할 것 같았다. 하지만, 탐색이 잘 된다. 책을 찾아보니 OSIV가 나오는데 후반부라 그런지 너무 어렵다..ㅋㅋ 직접 실험해보기로 했다.

여러번의 삽질끝에 OSIV를 끄면 제대로 작동하지 않는 것을 확인했다. 이유는 알았으니 공부를 해보자.

## 10.13

### 포스트스쿼드

#### pull request에 관한 생각

풀 리퀘스트에 여러 작업 단위가 섞이면 추적이 힘들다. 커밋을 잘게 나눈 의미가 퇴색된다. 이외에도 협업에 곤란해지는 상황이 생길 수 있다. 특정 기술이나 기능이 특정 부분에만 필요한게 아니라 전역으로 사용되는 경우에 해당 기능이 어디까지 구현된건지, 어디서부터 고쳐야 하는지 파악하기 힘들어진다. 단순히 기능 추가가 된 부분이라면 그나마 낫지만, 논의 없이 충돌해결이 되거나 다른 곳 까지 영향을 미치는 기능 변경이 생긴다면 조금 곤란해진다.

이번에 비슷한 경우가 생겼는데, 내가 구현한 부분과 충돌이 나는 부분이 생겨 다른 팀원이 충돌을 해결했다. 충돌을 해결하며 동작하는 테스트를 만들었고 코드는 문제없이 잘 작동한다. 하지만, 기능이 추가되면서 내가 만든 부분에 수정이 필요했던 것이라 추가적인 테스트 코드가 필요한 상황이다. 코드 리뷰를 하며 해당 사항을 인지하고 이슈로 남겨놨지만, 만약 놓쳤다면 해당 부분에서 문제가 발생하기 전까지는 테스트 코드 추가를 하지 않았을 것이다.

pr단위를 어떤 식으로 나누어야 하는지 아직도 어렵다. 그리고 너무 잘게 잘라도 비효율적일 것이다. 하지만, 어떤 문제가 발생할 수 있을지 인지하였으니 앞으로는 이런 부분을 고려해서 개발 단위를 나누어야 할 것 같다.

#### RestDocs 화면 출력 성공

드디어 동작한다. 이전 코드에 큰 문제가 있었던 것은 아닌 것 같다. gradle 버전 7을 사용할 경우 호환이 제대로 되지 않는 것이 문제였다. 현재 환경에서 제대로 구동하려면 추가적인 작업이 필요한데 일단은 문서를 띄워보는게 우선이니 버전을 6으로 낮추고 진행했다. 이제 잘 꾸미는 법을 알아볼 차례인데, 조금 겁이 난다..ㅋㅋ
