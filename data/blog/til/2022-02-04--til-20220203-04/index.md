---
title: TIL-20220203~04
createdDate: "2022-02-04 10:05:56"
updatedDate: "2022-02-04 10:05:56"
author: 정대화
tags:
  - til
draft: false
---

## 02.03

### 인턴1

#### 배치

##### 테스트

배치 테스트 어떻게 하는게 좋을까. SpringBatchTest 어노테이션이 있지만 사용하기가 쉽지 않다. 의존성이 꼬이는데 방법을 찾기 힘들다. 가장 큰 문제는 exclude가 제대로 동작하지 않는 다는 것... 여유가 있다면 이것 저것 하면서 세팅을 잡아가겠지만 일단은 스프링 부트 테스트로 잡아가기로 했다.

가장 애 먹었던 부분은 스케줄러를 어떻게 중지시킬지였는데, 테스트를 실행하면서 빈 등록을 해제하거나 할 수 있지만 컨텍스트가 시작된 이후이기 때문에 최초 한 번은 실행이 된다. 만약 안 된다면 운이 좋은 케이스인 것이다. 목업 객체를 이용해볼 수도 있겠지만, 좋아보이진 않는다. 빈을 모킹해야 하기 때문에 매번 등록을 해줘야 할거니까.

결국 프로필을 이용해 해결했다. 지금은 가장 좋아보인다. 향후에도 계속 사용될테고

##### 여러개 읽고 쓰기?

ItemReader 하나에 여러번의 Writer가 필요한 상황이다. 책에서 CompositeWriter를 찾았지만 결국 매핑이 달라져야 하기 때문에 문제가 있다.

다른 팀원분께 조언을 구했는데, 일정이 빡빡하니 우선 안전하고 쉬운 방법으로 갈 것 같다. 그리고 데이터가 그리 많지 않으면 크게 고려하지 않아도 될 것 같다는 것이 결론이었다. 만약 직접 개발한다면 배치보다는 이벤트를 사용할 것 같다는데, 앞으로는 MSA와 이벤트를 중심으로 공부해봐야겠다.

내일은 여러개를 Read해와야 하는 상황이다. 잘 헤쳐나가보자
